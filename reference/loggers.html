<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>App Logging — loggers • fiery</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="App Logging — loggers"><meta name="description" content="fiery has a build in logging mechanism that lets you capture event
information however you like. Every user-injested warnings and errors are
automatically captured by the logger along with most system errors as well.
fiery tries very hard not to break due to faulty app logic. This means that
any event handler error will be converted to an error log without fiery
stopping. In the case of request handlers a 500L response will be send back
if any error is encountered."><meta property="og:description" content="fiery has a build in logging mechanism that lets you capture event
information however you like. Every user-injested warnings and errors are
automatically captured by the logger along with most system errors as well.
fiery tries very hard not to break due to faulty app logic. This means that
any event handler error will be converted to an error log without fiery
stopping. In the case of request handlers a 500L response will be send back
if any error is encountered."><meta property="og:image" content="https://fiery.data-imaginist.com/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fiery</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/events.html">The event cycle</a></li>
    <li><a class="dropdown-item" href="../articles/plugins.html">Creating and using plugins</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Demos</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.data-imaginist.com/2017/setting-fire-to-deployment/">Fiery on Heroku</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Release notes</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.data-imaginist.com/2017/when-a-fire-starts-to-burn/">Version 1.0.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Change log</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://reqres.data-imaginist.com">reqres</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://routr.data-imaginist.com">routr</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/thomasp85/fiery"><span class="fa fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>App Logging</h1>
      <small class="dont-index">Source: <a href="https://github.com/thomasp85/fiery/blob/main/R/loggers.R" class="external-link"><code>R/loggers.R</code></a></small>
      <div class="d-none name"><code>loggers.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>fiery</code> has a build in logging mechanism that lets you capture event
information however you like. Every user-injested warnings and errors are
automatically captured by the logger along with most system errors as well.
<code>fiery</code> tries very hard not to break due to faulty app logic. This means that
any event handler error will be converted to an error log without <code>fiery</code>
stopping. In the case of request handlers a 500L response will be send back
if any error is encountered.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">logger_null</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">logger_console</span><span class="op">(</span>format <span class="op">=</span> <span class="st">"{time} - {event}: {message}"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">logger_file</span><span class="op">(</span><span class="va">file</span>, format <span class="op">=</span> <span class="st">"{time} - {event}: {message}"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">logger_switch</span><span class="op">(</span><span class="va">...</span>, default <span class="op">=</span> <span class="fu">logger_null</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">logger_logger</span><span class="op">(</span>default_level <span class="op">=</span> <span class="st">"INFO"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">common_log_format</span></span>
<span></span>
<span><span class="va">combined_log_format</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="format">Format<a class="anchor" aria-label="anchor" href="#format"></a></h2>
    <p>An object of class <code>character</code> of length 1.</p>
<p>An object of class <code>character</code> of length 1.</p>
    </div>
    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-format">format<a class="anchor" aria-label="anchor" href="#arg-format"></a></dt>
<dd><p>A <a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a> string specifying the format of the log entry</p></dd>


<dt id="arg-file">file<a class="anchor" aria-label="anchor" href="#arg-file"></a></dt>
<dd><p>A file or connection to write to</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>A named list of loggers to use for different events. The same
semantics as <a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a> is used so it is possible to let events
<em>fall through</em> e.g. <code>logger_switch(error =, warning = logger_file('errors.log'))</code>.</p></dd>


<dt id="arg-default">default<a class="anchor" aria-label="anchor" href="#arg-default"></a></dt>
<dd><p>A catch-all logger for use with events not defined in <code>...</code></p></dd>


<dt id="arg-default-level">default_level<a class="anchor" aria-label="anchor" href="#arg-default-level"></a></dt>
<dd><p>The log level to use for events that are not <code>request</code>,
<code>websocket</code>, <code>message</code>, <code>warning</code>, or <code>error</code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="setting-a-logger">Setting a logger<a class="anchor" aria-label="anchor" href="#setting-a-logger"></a></h2>


<p>By default, <code>fiery</code> uses <code>logger_null()</code> which forwards warning and error
messages to <code><a href="https://rdrr.io/r/base/showConnections.html" class="external-link">stderr()</a></code> and ignores any other logging events. To change this
behavior, set a different logger using the <code>set_logger()</code> method:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>app<span class="sc">$</span><span class="fu">set_logger</span>(logger)</span></code></pre><p></p></div>
<p>where <code>logger</code> is a function taking at least the following arguments: <code>event</code>,
<code>message</code>, <code>request</code>, <code>time</code>, and <code>...</code>.</p>
<p><code>fiery</code> comes with some additional loggers, which either writes all logs to a
file or to the console. A new instance of the file logger can be created with
<code>logger_file(file)</code>:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>app<span class="sc">$</span><span class="fu">set_logger</span>(<span class="fu">logger_file</span>(<span class="st">'fiery_log.log'</span>))</span></code></pre><p></p></div>
<p>A new instance of the console logger can be create with <code>logger_console()</code>:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>app<span class="sc">$</span><span class="fu">set_logger</span>(<span class="fu">logger_console</span>())</span></code></pre><p></p></div>
<p>Both functions takes a <code>format</code> a argument that lets you customise how the
log is written. Furthermore the console logger will style the logs with
colour coding depending on the content if the console supports it.</p>
<p>As a last possibility it is possible to use different loggers dependent on
the event by using the switch logger:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>app<span class="sc">$</span><span class="fu">set_logger</span>(<span class="fu">logger_switch</span>(<span class="at">warning =</span>,</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>                             <span class="at">error =</span> <span class="fu">logger_file</span>(<span class="st">'errors.log),</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="st">                             default = logger_file('</span>info.log<span class="st">')))</span></span></code></pre><p></p></div>
    </div>
    <div class="section level2">
    <h2 id="automatic-logs">Automatic logs<a class="anchor" aria-label="anchor" href="#automatic-logs"></a></h2>


<p><code>fiery</code> logs a number of different information by itself describing its
operations during run. The following events are send to the log:</p>
<dl><dt><em>start</em></dt>
<dd><p>Will be send when the server starts up</p></dd>

<dt><em>resume</em></dt>
<dd><p>Will be send when the server is resumed</p></dd>

<dt><em>stop</em></dt>
<dd><p>Will be send when the server stops</p></dd>

<dt><em>request</em></dt>
<dd><p>Will be send when a request has been handled. The message
will contain information about how long time it took to handle the request
or if it was denied.</p></dd>

<dt><em>websocket</em></dt>
<dd><p>Will be send every time a WebSocket connection is
established or closed as well as when a message is received or send</p></dd>

<dt><em>message</em></dt>
<dd><p>Will be send every time a message is emitted by an event
handler or delayed execution handler</p></dd>

<dt><em>warning</em></dt>
<dd><p>Will be send everytime a warning is emitted by an event
handler or delayed execution handler</p></dd>

<dt><em>error</em></dt>
<dd><p>Will be send everytime an error is signaled by an event
handler or delayed execution handler. In addition some internal functions
will also emit error event when exceptions are encountered</p></dd>


</dl><p>By default only <em>message</em>, <em>warning</em> and <em>error</em> events will be logged by
sending them to the error stream as a <code><a href="https://rdrr.io/r/base/message.html" class="external-link">message()</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="access-logs">Access Logs<a class="anchor" aria-label="anchor" href="#access-logs"></a></h2>


<p>Of particular interest are logs that detail requests made to the server.
These are the <code>request</code> events detailed above. There are different standards
for how requests are logged. <code>fiery</code> uses the <em>Common Log Format</em> by default,
but this can be modified by setting the <code>access_log_format</code> field to a
<a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a> expression that has access to the following variables:</p>
<dl><dt><code>start_time</code></dt>
<dd><p>The time the request was recieved</p></dd>

<dt><code>end_time</code></dt>
<dd><p>The time the response was send back</p></dd>

<dt><code>request</code></dt>
<dd><p>The <code>Request</code> object</p></dd>

<dt><code>response</code></dt>
<dd><p>The <code>Response</code> object</p></dd>

<dt><code>id</code></dt>
<dd><p>The client id</p></dd>


</dl><p>To change the format:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>app<span class="sc">$</span>access_log_format <span class="ot">&lt;-</span> combined_log_format</span></code></pre><p></p></div>
    </div>
    <div class="section level2">
    <h2 id="custom-logs">Custom logs<a class="anchor" aria-label="anchor" href="#custom-logs"></a></h2>


<p>Apart from the standard logs described above it is also possible to send
messages to the log as you please, e.g. inside event handlers. This is done
through the <code><a href="https://rdrr.io/r/base/Log.html" class="external-link">log()</a></code> method where you at the very least specify an event and a
message. In general it is better to send messages through <code><a href="https://rdrr.io/r/base/Log.html" class="external-link">log()</a></code> rather than
with <code><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning()</a></code> and <code><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop()</a></code> even though the latters will eventually be
caught, as it gives you more control over the logging and what should happen
in the case of an exception.</p>
<p>An example of using <code><a href="https://rdrr.io/r/base/Log.html" class="external-link">log()</a></code> in a handler could be:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>app<span class="sc">$</span><span class="fu">on</span>(<span class="st">'header'</span>, <span class="cf">function</span>(server, id, request) {</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  server<span class="sc">$</span><span class="fu">log</span>(<span class="st">'info'</span>, <span class="fu">paste0</span>(<span class="st">'request from '</span>, id, <span class="st">' received'</span>), request)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>})</span></code></pre><p></p></div>
<p>Which would log the timepoint the headers of a request has been recieved.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://data-imaginist.com" class="external-link">Thomas Lin Pedersen</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

