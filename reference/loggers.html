<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>App Logging — loggers • fiery</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="App Logging — loggers"><meta property="og:description" content="fiery has a build in logging mechanism that lets you capture event
information however you like. Every user-injested warnings and errors are
automatically captured by the logger along with most system errors as well.
fiery tries very hard not to break due to faulty app logic. This means that
any event handler error will be converted to an error log without fiery
stopping. In the case of request handlers a 500L response will be send back
if any error is encountered."><meta property="og:image" content="https://fiery.data-imaginist.com/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fiery</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.3.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/events.html">The event cycle</a>
    </li>
    <li>
      <a href="../articles/delayed.html">Delaying code execution</a>
    </li>
    <li>
      <a href="../articles/plugins.html">Creating and using plugins</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Demos</li>
    <li>
      <a href="https://www.data-imaginist.com/2017/setting-fire-to-deployment/" class="external-link">Fiery on Heroku</a>
    </li>
  </ul></li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li class="dropdown-header">Release notes</li>
    <li>
      <a href="https://www.data-imaginist.com/2017/when-a-fire-starts-to-burn/" class="external-link">Version 1.0.0</a>
    </li>
    <li class="divider">
    <li>
      <a href="../news/index.html">Change log</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://reqres.data-imaginist.com" class="external-link">reqres</a>
</li>
<li>
  <a href="https://routr.data-imaginist.com" class="external-link">routr</a>
</li>
<li>
  <a href="https://github.com/thomasp85/fiery" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>App Logging</h1>
    <small class="dont-index">Source: <a href="https://github.com/thomasp85/fiery/blob/HEAD/R/loggers.R" class="external-link"><code>R/loggers.R</code></a></small>
    <div class="hidden name"><code>loggers.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>fiery</code> has a build in logging mechanism that lets you capture event
information however you like. Every user-injested warnings and errors are
automatically captured by the logger along with most system errors as well.
<code>fiery</code> tries very hard not to break due to faulty app logic. This means that
any event handler error will be converted to an error log without <code>fiery</code>
stopping. In the case of request handlers a 500L response will be send back
if any error is encountered.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">logger_null</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">logger_console</span><span class="op">(</span>format <span class="op">=</span> <span class="st">"{time} - {event}: {message}"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">logger_file</span><span class="op">(</span><span class="va">file</span>, format <span class="op">=</span> <span class="st">"{time} - {event}: {message}"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">logger_switch</span><span class="op">(</span><span class="va">...</span>, default <span class="op">=</span> <span class="fu">logger_null</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">common_log_format</span></span>
<span></span>
<span><span class="va">combined_log_format</span></span></code></pre></div>
    </div>

    <div id="format">
    <h2>Format</h2>
    <p>An object of class <code>character</code> of length 1.</p>
<p>An object of class <code>character</code> of length 1.</p>
    </div>
    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>format</dt>
<dd><p>A <a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a> string specifying the format of the log entry</p></dd>


<dt>file</dt>
<dd><p>A file or connection to write to</p></dd>


<dt>...</dt>
<dd><p>A named list of loggers to use for different events. The same
semantics as <a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a> is used so it is possible to let events
<em>fall through</em> e.g. <code>logger_switch(error =, warning = logger_file('errors.log'))</code>.</p></dd>


<dt>default</dt>
<dd><p>A catch-all logger for use with events not defined in <code>...</code></p></dd>

</dl></div>
    <div id="setting-a-logger">
    <h2>Setting a logger</h2>
    

<p>By default, <code>fiery</code> uses <code>logger_null()</code> which forwards warning and error
messages to <code><a href="https://rdrr.io/r/base/showConnections.html" class="external-link">stderr()</a></code> and ignores any other logging events. To change this
behavior, set a different logger using the <code>set_logger()</code> method:</p><div class="sourceCode"><pre><code><span><span class="va">app</span><span class="op">$</span><span class="fu">set_logger</span><span class="op">(</span><span class="va">logger</span><span class="op">)</span></span></code></pre></div>

<p>where <code>logger</code> is a function taking at least the following arguments: <code>event</code>,
<code>message</code>, <code>request</code>, <code>time</code>, and <code>...</code>.</p>
<p><code>fiery</code> comes with some additional loggers, which either writes all logs to a
file or to the console. A new instance of the file logger can be created with
<code>logger_file(file)</code>:</p><div class="sourceCode"><pre><code><span><span class="va">app</span><span class="op">$</span><span class="fu">set_logger</span><span class="op">(</span><span class="fu"><a href="../reference/loggers.html">logger_file</a></span><span class="op">(</span><span class="st">'fiery_log.log'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>

<p>A new instance of the console logger can be create with <code>logger_console()</code>:</p><div class="sourceCode"><pre><code><span><span class="va">app</span><span class="op">$</span><span class="fu">set_logger</span><span class="op">(</span><span class="fu"><a href="../reference/loggers.html">logger_console</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>

<p>Both functions takes a <code>format</code> a argument that lets you customise how the
log is written. Furthermore the console logger will style the logs with
colour coding depending on the content if the console supports it.</p>
<p>As a last possibility it is possible to use different loggers dependent on
the event by using the switch logger:</p><div class="sourceCode"><pre><code>app$set_logger(logger_switch(warning =, 
                             error = logger_file('errors.log),
                             default = logger_file('info.log')))
</code></pre></div>

    </div>
    <div id="automatic-logs">
    <h2>Automatic logs</h2>
    

<p><code>fiery</code> logs a number of different information by itself describing its
operations during run. The following events are send to the log:</p>
<dl><dt><em>start</em></dt>
<dd><p>Will be send when the server starts up</p></dd>

<dt><em>resume</em></dt>
<dd><p>Will be send when the server is resumed</p></dd>

<dt><em>stop</em></dt>
<dd><p>Will be send when the server stops</p></dd>

<dt><em>request</em></dt>
<dd><p>Will be send when a request has been handled. The message
will contain information about how long time it took to handle the request
or if it was denied.</p></dd>

<dt><em>websocket</em></dt>
<dd><p>Will be send every time a WebSocket connection is
established or closed as well as when a message is received or send</p></dd>

<dt><em>message</em></dt>
<dd><p>Will be send every time a message is emitted by an event
handler or delayed execution handler</p></dd>

<dt><em>warning</em></dt>
<dd><p>Will be send everytime a warning is emitted by an event
handler or delayed execution handler</p></dd>

<dt><em>error</em></dt>
<dd><p>Will be send everytime an error is signaled by an event
handler or delayed execution handler. In addition some internal functions
will also emit error event when exceptions are encountered</p></dd>


</dl><p>By default only <em>message</em>, <em>warning</em> and <em>error</em> events will be logged by
sending them to the error stream as a <code><a href="https://rdrr.io/r/base/message.html" class="external-link">message()</a></code>.</p>
    </div>
    <div id="access-logs">
    <h2>Access Logs</h2>
    

<p>Of particular interest are logs that detail requests made to the server.
These are the <code>request</code> events detailed above. There are different standards
for how requests are logged. <code>fiery</code> uses the <em>Common Log Format</em> by default,
but this can be modified by setting the <code>access_log_format</code> field to a
<a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a> expression that has access to the following variables:</p>
<dl><dt><code>start_time</code></dt>
<dd><p>The time the request was recieved</p></dd>

<dt><code>end_time</code></dt>
<dd><p>The time the response was send back</p></dd>

<dt><code>request</code></dt>
<dd><p>The <code>Request</code> object</p></dd>

<dt><code>response</code></dt>
<dd><p>The <code>Response</code> object</p></dd>

<dt><code>id</code></dt>
<dd><p>The client id</p></dd>


</dl><p>To change the format:</p><div class="sourceCode"><pre><code><span><span class="va">app</span><span class="op">$</span><span class="va">access_log_format</span> <span class="op">&lt;-</span> <span class="va">combined_log_format</span></span></code></pre></div>

    </div>
    <div id="custom-logs">
    <h2>Custom logs</h2>
    

<p>Apart from the standard logs described above it is also possible to send
messages to the log as you please, e.g. inside event handlers. This is done
through the <code><a href="https://rdrr.io/r/base/Log.html" class="external-link">log()</a></code> method where you at the very least specify an event and a
message. In general it is better to send messages through <code><a href="https://rdrr.io/r/base/Log.html" class="external-link">log()</a></code> rather than
with <code><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning()</a></code> and <code><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop()</a></code> even though the latters will eventually be
caught, as it gives you more control over the logging and what should happen
in the case of an exception.</p>
<p>An example of using <code><a href="https://rdrr.io/r/base/Log.html" class="external-link">log()</a></code> in a handler could be:</p><div class="sourceCode"><pre><code><span><span class="va">app</span><span class="op">$</span><span class="fu">on</span><span class="op">(</span><span class="st">'header'</span>, <span class="kw">function</span><span class="op">(</span><span class="va">server</span>, <span class="va">id</span>, <span class="va">request</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">server</span><span class="op">$</span><span class="fu">log</span><span class="op">(</span><span class="st">'info'</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'request from '</span>, <span class="va">id</span>, <span class="st">' received'</span><span class="op">)</span>, <span class="va">request</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>

<p>Which would log the timepoint the headers of a request has been recieved.</p>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://data-imaginist.com" class="external-link">Thomas Lin Pedersen</a>.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

